# 6redis测试

`redis-benchmark [option] [option value]`

|         |                           |                                            |       |
| ------- | ------------------------- | ------------------------------------------ | ----- |
| ** -h** | 指定服务器主机名          | 127.0.0.1                                  |       |
| 2       | **-p**                    | 指定服务器端口                             | 6379  |
| 3       | **-s**                    | 指定服务器 socket                          |       |
| 4       | **-c**                    | 指定并发连接数                             | 50    |
| 5       | **-n**                    | 指定请求数                                 | 10000 |
| 6       | **-d**                    | 以字节的形式指定 SET/GET 值的数据大小      | 2     |
| 7       | **-k**                    | 1=keep alive 0=reconnect                   | 1     |
| 8       | **-r**                    | SET/GET/INCR 使用随机 key, SADD 使用随机值 |       |
| 9       | **-P**                    | 通过管道传输 <numreq> 请求                 | 1     |
| 10      | **-q**                    | 强制退出 redis。仅显示 query/sec 值        |       |
| 11      | **--csv**                 | 以 CSV 格式输出                            |       |
| 12      | ***-l\*（L 的小写字母）** | 生成循环，永久执行测试                     |       |
| 13      | **-t**                    | 仅运行以逗号分隔的测试命令列表。           |       |
| 14      | ***-I\*（i 的大写字母）** | Idle 模式。仅打开 N 个 idle 连接并等待。   |       |

## 1.使用 redis benchmark 工具, 测试 10 20 50 100 200 1k 5k 字节 value 大小，redis get set 性能

```go
redis-benchmark -d 10 -t get,set
```

GET

|      | 100000 requests completed | requests per second |
| ---- | :-----------------------: | :-----------------: |
| 10   |         192307.70         |    0.52 seconds     |
| 20   |         192307.70         |    0.52 seconds     |
| 50   |         199600.80         |    0.50 seconds     |
| 100  |         195312.48         |    0.51 seconds     |
| 200  |         194931.77         |    0.51 seconds     |
| 1024 |         197238.64         |    0.51 seconds     |
| 5120 |         183486.23         |    0.56 seconds     |

SET

|      | requests per second | 100000 requests completed |
| ---- | :-----------------: | :-----------------------: |
| 10   |      191204.59      |       0.52 seconds        |
| 20   |      200400.80      |       0.50 seconds        |
| 50   |      192307.70      |       0.52 seconds        |
| 100  |      192678.23      |       0.52 seconds        |
| 200  |      196850.39      |       0.50 seconds        |
| 1024 |      196463.66      |       0.51 seconds        |
| 5120 |      183486.23      |       0.55 seconds        |

`在1k字节以前.redis的get set性能没有变化.在5K的时候大概有10%的下降`



## 2.写入一定量的 kv 数据, 根据数据大小 1w-50w 自己评估, 结合写入前后的 info memory 信息 , 分析上述不同 value 大小下，平均每个 key 的占用内存空间。

``` go
# Memory
used_memory:13490096 //数据占用了多少内存（字节）
used_memory_human:12.87M //数据占用了多少内存（带单位的，可读性好）
used_memory_rss:13490096  //redis占用了多少内存
used_memory_peak:15301192 //占用内存的峰值（字节）
used_memory_peak_human:14.59M //占用内存的峰值（带单位的，可读性好）
used_memory_lua:31744  //lua引擎所占用的内存大小（字节）
mem_fragmentation_ratio:1.00  //内存碎片率`
```

```go
FLUSHALL //清空数据
redis-cli.exe info 
```



```go

redis-benchmark -t set -r 100000 -n 100000 -d 10
```

| –    | 占用内存             | key个数 | 每个key占用内存 |
| ---- | -------------------- | ------- | --------------- |
| 10   | 1142696 -> 6719160   | 63150   | 88              |
| 20   | 1122088 -> 7210792   | 63232   | 96              |
| 50   | 1122240 -> 9281096   | 63280   | 145             |
| 100  | 1122408 -> 12810024  | 63428   | 184             |
| 200  | 1163512 -> 19856568  | 63086   | 296             |
| 1024 | 1122712 -> 86320344  | 63001   | 1352            |
| 5120 | 1122864 -> 393868768 | 63180   | 6216            |

`在100字节之前.每个key占用的大小随着value增长10%,100字节以后成倍数增长`